<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Psychedelic Sketch ‚Äî Wavy Turbulence + Symmetry Modes (Improved Bounds)</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div id="app">
  <canvas id="c"></canvas>

  <div class="topbar">
    <button id="menuBtn" class="btn" aria-label="Settings"><span class="icon">‚öôÔ∏è</span> Settings</button>
    <div class="chip" id="hint">Bounds fixed ‚Ä¢ New ‚ÄúHide‚Äù masks outside ‚Ä¢ Symmetry slices work in all modes + Angle control</div>
    <div style="display:flex; gap:8px;">
      <button id="sensorBtn" class="btn" aria-label="Enable sensors"><span class="icon">üì≥</span> Sensors</button>
      <button id="saveBtn" class="btn" aria-label="Save"><span class="icon">üì∏</span></button>
    </div>
  </div>

  <!-- Tabbed settings panel -->
  <div id="panel" class="hidden">
    <div class="tabs" id="tabs">
      <button class="tabbtn active" data-tab="brush">Brush</button>
      <button class="tabbtn" data-tab="color">Color</button>
      <button class="tabbtn" data-tab="turb">Turbulence</button>
      <button class="tabbtn" data-tab="sensors">Sensors</button>
      <button class="tabbtn" data-tab="bounds">Bounds</button>
      <button class="tabbtn" data-tab="visuals">Visuals</button>
      <button class="tabbtn" data-tab="system">System</button>
    </div>

    <div class="tabcontent active" id="tab-brush">
      <div class="section">
        <div class="control">
          <label>Brush type
            <select id="brushType">
              <option value="stroke" selected>Stroke (solid)</option>
              <option value="dots">Dots</option>
              <option value="spray">Spray</option>
            </select>
          </label>

          <div id="strokeBlock">
            <label>Width mode
              <select id="widthMode">
                <option value="constant" selected>Constant</option>
                <option value="speed">Speed-based</option>
              </select>
            </label>
            <label>Min width <span id="widthMinVal"></span></label>
            <input type="range" id="widthMin" min="1" max="40" step="1" value="2" />
            <label>Max width <span id="widthMaxVal"></span></label>
            <input type="range" id="widthMax" min="2" max="80" step="1" value="18" />
            <label id="widthRangeLabel" style="display:none;">Width range (px/s) <span id="widthRangeVal"></span></label>
            <input type="range" id="widthRange" min="100" max="3000" step="10" value="1200" style="display:none;" />
            <label>Stroke opacity <span id="strokeAlphaVal"></span></label>
            <input type="range" id="strokeAlpha" min="0.2" max="1" step="0.01" value="0.95" />
            <label>Stroke detail <span id="strokeDetailVal"></span></label>
            <input type="range" id="strokeDetail" min="0.5" max="3" step="0.05" value="1.4" />
            <label>Line cap
              <select id="lineCap">
                <option value="round" selected>Round</option>
                <option value="butt">Butt</option>
                <option value="square">Square</option>
              </select>
            </label>
            <label>Line join
              <select id="lineJoin">
                <option value="round" selected>Round</option>
                <option value="bevel">Bevel</option>
                <option value="miter">Miter</option>
              </select>
            </label>
          </div>

          <div id="dotsBlock" style="display:none;">
            <label>Dot size (Brush size) <span id="sizeVal"></span></label>
            <input type="range" id="size" min="1" max="100" step="1" value="30" />
          </div>

          <label>Glow (off by default) <span id="glowVal"></span></label>
          <input type="range" id="glow" min="0" max="70" step="1" value="0" />
        </div>

        <div class="control">
          <label>Symmetry mode
            <select id="symMode">
              <option value="off">Off</option>
              <option value="radial">Radial</option>
              <option value="radial-kaleido" selected>Kaleido (radial)</option>
              <option value="mirror-vertical">Mirror Vertical</option>
              <option value="mirror-horizontal">Mirror Horizontal</option>
              <option value="diagonals">Diagonals (45¬∞)</option>
              <option value="octa">Octa (X/Y + Diagonals)</option>
              <option value="quad">Quad (X + Y)</option>
            </select>
          </label>

          <div id="symSlicesBlock">
            <label>Symmetry copies/axes <span id="symVal"></span></label>
            <input type="range" id="sym" min="1" max="48" step="1" value="10" />
            <label>Symmetry angle (¬∞) <span id="symAngVal"></span></label>
            <input type="range" id="symAngle" min="-180" max="180" step="1" value="0" />
          </div>
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-color">
      <div class="section">
        <div class="control">
          <label>Palette
            <select id="palette">
              <option>Rainbow</option>
              <option>Neon</option>
              <option>Sunset</option>
              <option>Ocean</option>
              <option>Acid</option>
            </select>
          </label>
          <label>Color mode
            <select id="colorMode">
              <option value="palette" selected>Palette</option>
              <option value="velocity">Velocity</option>
              <option value="accel">Acceleration</option>
              <option value="spin">Spin (gyro)</option>
              <option value="direction">Direction</option>
              <option value="heat">Heat</option>
            </select>
          </label>
          <label id="metricRangeLabel">Metric range <span id="metricRangeVal"></span></label>
          <input type="range" id="metricRange" min="1" max="600" step="1" value="180" />
          <div id="heatControls">
            <label>Heat gain <span id="heatGainVal"></span></label>
            <input type="range" id="heatGain" min="0" max="2" step="0.02" value="0.6" />
            <label>Heat decay <span id="heatDecayVal"></span></label>
            <input type="range" id="heatDecay" min="0" max="1" step="0.01" value="0.14" />
          </div>
          <label>Color speed <span id="colorSpeedVal"></span></label>
          <input type="range" id="colorSpeed" min="0" max="1.2" step="0.01" value="0.48" />
          <div class="row">
            <button id="lockColor" class="btn pill">Lock color per segment</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-turb">
      <div class="section">
        <div class="control">
          <label>Turbulence mode
            <select id="turbMode">
              <option value="off">Off</option>
              <option value="noise">Noise</option>
              <option value="curl" selected>Curl</option>
            </select>
          </label>
          <label>Distortion
            <select id="turbDist">
              <option value="perp" selected>Perp wobble</option>
              <option value="flow">Flow warp</option>
              <option value="both">Both</option>
            </select>
          </label>
          <label>Intensity <span id="turbIntVal"></span></label>
          <input type="range" id="turbInt" min="0" max="1.2" step="0.01" value="0.65" />
          <label>Scale <span id="turbScaleVal"></span></label>
          <input type="range" id="turbScale" min="0.001" max="0.03" step="0.001" value="0.009" />
          <label>Flow speed <span id="turbSpeedVal"></span></label>
          <input type="range" id="turbSpeed" min="0" max="2" step="0.01" value="0.6" />
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-sensors">
      <div class="section">
        <div class="control">
          <label>Sensor mode
            <select id="sensorMode">
              <option value="off">Off</option>
              <option value="tilt">Tilt (stable map)</option>
              <option value="motion">Motion (inertial)</option>
              <option value="motion-swirl">Motion + Gyro swirl</option>
              <option value="motion-raw">Motion Raw (very responsive)</option>
              <option value="tilt-spring">Tilt Spring (spring-damper)</option>
              <option value="gyro-orbit">Gyro orbit</option>
              <option value="shake-burst">Shake Burst</option>
            </select>
          </label>
          <label>Sensor influence <span id="sensorInfVal"></span></label>
          <input type="range" id="sensorInf" min="0" max="1" step="0.01" value="0.7" />
          <label>Motion sensitivity <span id="motionSensVal"></span></label>
          <input type="range" id="motionSens" min="0.2" max="6" step="0.05" value="2.2" />
          <label>Amp <span id="ampVal"></span></label>
          <input type="range" id="amp" min="0.3" max="5" step="0.05" value="1.6" />
          <label>Speed cap (px/s) <span id="speedCapVal"></span></label>
          <input type="range" id="speedCap" min="300" max="4000" step="10" value="1600" />
          <label>Friction <span id="frictionVal"></span></label>
          <input type="range" id="friction" min="0.60" max="0.98" step="0.01" value="0.92" />
          <label>Deadzone <span id="deadzoneVal"></span></label>
          <input type="range" id="deadzone" min="0" max="0.3" step="0.01" value="0.06" />
        </div>

        <div class="control">
          <label>Spring K <span id="springKVal"></span></label>
          <input type="range" id="springK" min="1" max="30" step="0.5" value="10" />
          <label>Damping <span id="springDVal"></span></label>
          <input type="range" id="springD" min="0.6" max="0.98" step="0.01" value="0.88" />
          <label>Spin gain <span id="spinGainVal"></span></label>
          <input type="range" id="spinGain" min="0" max="3" step="0.05" value="1.2" />
          <label>Min draw speed <span id="minDrawVal"></span></label>
          <input type="range" id="minDraw" min="0" max="0.5" step="0.01" value="0.08" />
          <label>Filter strength <span id="filterVal"></span></label>
          <input type="range" id="filter" min="0" max="0.95" step="0.01" value="0.4" />
          <div class="row">
            <button id="useLinear" class="btn pill active">Linear Accel</button>
            <button id="shakeClear" class="btn pill">Shake clears</button>
            <button id="sensorDraw" class="btn pill active">Sensor draws</button>
            <button id="showBrushBtn" class="btn pill active">Show brush</button>
            <button id="calibrate" class="btn pill">Calibrate</button>
            <button id="center" class="btn pill">Center Brush</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-bounds">
      <div class="section">
        <div class="control">
          <label>Region
            <select id="boundsRegion">
              <option value="screen" selected>Screen</option>
              <option value="circle">Circle (center)</option>
              <option value="rect">Rect (center)</option>
            </select>
          </label>
          <label>Behavior
            <select id="boundsBehavior">
              <option value="wrap">Wrap</option>
              <option value="bounce" selected>Bounce</option>
              <option value="hide">Hide (mask outside)</option>
            </select>
          </label>
          <label>Circle radius (%) <span id="circleRadiusVal"></span></label>
          <input type="range" id="circleRadius" min="20" max="100" step="1" value="68" />
          <label>Rect width (%) <span id="rectWVal"></span></label>
          <input type="range" id="rectW" min="20" max="100" step="1" value="72" />
          <label>Rect height (%) <span id="rectHVal"></span></label>
          <input type="range" id="rectH" min="20" max="100" step="1" value="60" />
          <label>Edge padding <span id="edgePadVal"></span></label>
          <input type="range" id="edgePad" min="0" max="40" step="1" value="0" />
          <div class="row">
            <button id="clipDraw" class="btn pill active">Clip draw to bounds</button>
            <button id="showBounds" class="btn pill">Show bounds</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-visuals">
      <div class="section">
        <div class="control">
          <label>Trail fade <span id="fadeVal"></span></label>
          <input type="range" id="fade" min="0" max="0.25" step="0.005" value="0.035" />
          <label>Scatter <span id="scatterVal"></span></label>
          <input type="range" id="scatter" min="0" max="1" step="0.01" value="0.2" />
        </div>
        <div class="control">
          <label>Background
            <select id="bgMode">
              <option value="dark">Dark</option>
              <option value="deep">Deep Gradient</option>
              <option value="light">Light</option>
            </select>
          </label>
          <div class="row">
            <button id="composite" class="btn pill active">Additive</button>
            <button id="randomize" class="btn pill">Randomize</button>
          </div>
        </div>
      </div>
    </div>

    <div class="tabcontent" id="tab-system">
      <div class="section">
        <div class="control">
          <label>Quality
            <select id="quality">
              <option value="performance">Performance</option>
              <option value="balanced" selected>Balanced</option>
              <option value="high">High</option>
            </select>
          </label>
          <div class="row">
            <button id="resetView" class="btn pill">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="legend" id="legend">Symmetry: use Slices + Angle ‚Ä¢ Bounds: Hide = mask, Wrap = Pac‚ÄëMan, Bounce = reflect</div>

  <div class="bottombar">
    <button id="clearBtn" class="fab secondary">Clear</button>
    <button id="autoBtn" class="fab">Auto</button>
  </div>
</div>

<script type="module" src="js/main.js"></script>
</body>
</html>